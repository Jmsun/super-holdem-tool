<!doctype html>
<html>
<meta charset="utf-8">
<title>Speak AutoClose</title>
<body style="display:flex;justify-content:center;align-items:center;height:100vh;background:#fafafa">
<script>
(function(){
  const sp = new URL(location.href).searchParams;
  const text = sp.get("t") || "没有提供文字";
  const lang = sp.get("lang") || "zh-CN";
  const rate = parseFloat(sp.get("rate")||"1.05");
  const pitch= parseFloat(sp.get("pitch")||"1.0");

  function speakAndClose() {
    try {
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang;
      u.rate = rate;
      u.pitch = pitch;
      speechSynthesis.speak(u);

      // 尝试在播报开始 1 秒后关闭窗口
      setTimeout(function(){
        try { window.close(); } catch(e) {}
      }, 6000);

    } catch(e) {
      console.error("无法播报", e);
    }
  }

  // 必须用户触发时更稳，这里直接尝试自动播报
  window.addEventListener("load", speakAndClose);
})();
</script>
</body>
</html>
